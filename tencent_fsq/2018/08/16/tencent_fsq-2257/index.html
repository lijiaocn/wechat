<!DOCTYPE html>
<html lang="chinese">
<head>
<meta charset="utf-8" content="text/html">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>验证码前端性能分析及优化实践|腾讯防水墙|微信公众号文章合集|鼹鼠看看</title>
<meta name="description" content="本文分享了腾讯防水墙团队对于验证码前端技术方案的总结，以滑动验证码为切入点，阐述了如何提升前端性能与用户体验。希望能够抛砖引玉，给相关技术团队提供一些思路和启发。" />
<meta name="keywords" content="腾讯防水墙,tencent_fsq,微信公众号,公众号文章导出"/>
<link rel="shortcut icon" href="/wechat/favicon.ico"/>
<link rel="bookmark" href="/wechat/favicon.ico"/>
<link rel="stylesheet" href="/wechat/assets/css/style.css">
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- google ad -->
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-8176866190626448",
          enable_page_level_ads: true
     });
</script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-105389858-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-105389858-1');
</script>

<script async>
/*百度统计*/
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8f59ea10145df28da8932c8743ec1d60";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();

/*百度自动收录*/
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>






</head>

<body class="body">
    <div class="top">
            
<style type="text/css" scoped>
    .innerbanner{
        background:gray;
        color:white;
        padding-right:10px;
        padding-right:1rem;
        padding-left:10px;
        padding-left:1rem;
        padding-top:10px;
        padding-top:1rem;
        display:flex;
        flex-direction:row;
        justify-content: center;
        align-items: flex-start;
        width:100%;
        font-size:15px;
        font-size:1.5rem;
        /*
        overflow:hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
        */
    }
    .innerbanner a{
        color:white;
    }
    .innerbanner a:hover{
        color: black;
        text-decoration: none;
        font-size:large;
    }
    .innerbanner #inner_ul {
        display:flex;
        color:white;
        padding-left:0px;
        margin:0px;
        align-items: flex-start;
    }
    .innerbanner #inner_li {
        list-style:none;
        display:inline-block;
        line-height:25px;
        line-height:2.5rem
    }
    .topdetails{
        top:10px;
        top:1rem;
        display: inline-block;
    }
    .topdetails summary::-webkit-details-marker {
        display: none;
    }
    .topdetails summary:first-of-type {
        list-style-type: none;
    }
    .topdetails ul{
        padding:0px;
    }
    .topdetails li{
        list-style:none;
        text-indent:0px;
    }
    .topdetails a{
        display:block;
        background:gray;
        color:white;
        height:30px;
        height:3rem;
        padding-top:10px;
        padding-top:1rem;
        padding-left:10px;
        padding-left:1rem;
        padding-right:10px;
        padding-right:1rem;
    }
    .topdetails a:hover{
        background:darkgray;
        /*color: white;*/
        color: black;
    }

    @media screen and (max-width: 1024px){
        .innerbanner #inner_ul{
            list-style:none;
            display:block;
        }
    }
</style>
<div class="innerbanner" id="bannerid">
    <ul id="inner_ul">
    
        <li id="inner_li" style="">
        
                <a target="_blank" href="/">
                鼹鼠首页
                </a>&nbsp&nbsp&nbsp
        
        </li>
    
        <li id="inner_li" style="">
        
                <a target="_blank" href="/">
                <span style='color:blue'>全球网购></span>
                </a>&nbsp&nbsp&nbsp
        
        </li>
    
        <li id="inner_li" style="">
        
                <a target="_blank" href="https://c.duomai.com/track.php?k=WYppWas1DZpVXZmcDOwMTPklWYmAjMzUjMy0DZp9VZ0l2cmYiRyUSbvNmLzYTMuU3b5ZkMlYkMlE0MlAHd0hWP0Zibj9">
                网易严选
                </a>&nbsp&nbsp&nbsp
        
        </li>
    
        <li id="inner_li" style="">
        
                <a target="_blank" href="https://c.duomai.com/track.php?k=j9WYppWas1DZpVXZmczM3ETPklWYmAjMzUjMy0DZp9VZ0l2cmYiJGJTJt92YuEGbvF2auc3d3ZkMlYkMlE0MlAHd0hWP0Zib">
                考拉海购
                </a>&nbsp&nbsp&nbsp
        
        </li>
    
        <li id="inner_li" style="">
        
                <a target="_blank" href="https://click.dji.com/AL-LSUOcsiUUt2UUzOSh?as=0003&ch=ctool&pm=custom">
                无人机
                </a>&nbsp&nbsp&nbsp
        
        </li>
    
        <li id="inner_li" style="">
        
                <a target="_blank" href="https://c.duomai.com/track.php?k=lAHd0hWP0Zibj9WYppWas1DZpVXZmQDOzMTPklWYmAjMzUjMy0DZp9VZ0l2cmYiJpFWbvVHZfB3ckR0Ml02byZmeGNTJGJTJt92Yu8Wd69WY6ZkMlYkMlE0M">
                造作
                </a>&nbsp&nbsp&nbsp
        
        </li>
    
        <li id="inner_li" style="">
        
                <a target="_blank" href="https://c.duomai.com/track.php?k=m0DZpVXZmITO5MTPklWYmAjMzUjMy0DZp9VZ0l2cm02bj5CdyF2d55yd3dnRyUiRyUSQzUycwRHdo1Dd">
                艺网
                </a>&nbsp&nbsp&nbsp
        
        </li>
    
        <li id="inner_li" style="">
        
                <a target="_blank" href="https://c.duomai.com/track.php?k=ibj9WYppWas1DZpVXZmMDMxITPklWYmAjMzUjMy0DZp9VZ0l2cmYiJuNmLt92YukHbu9WZz9mcuc3d3ZkMlYkMlE0MlAHd0hWP0Z">
                RoseOnly.
                </a>&nbsp&nbsp&nbsp
        
        </li>
    
        <li id="inner_li" style="">
        
                <a target="_blank" href="http://g.click.taobao.com/q?ak=24663635&pid=mm_33963329_6520758_142982992&unid=lijiaocn&rf=http%3A%2F%2Fwww.lijiaocn.com%2F%25E5%25A5%25BD%25E8%25B4%25A7%2F2010%2F10%2F10%2Fsites.html&rd=2&et=97775937&pgid=be61cbd8f3af2ff376aa0c1a3103628d&ct=url%3Dhttps%253A%252F%252Fwww.tmall.com%252F&v=1.2&ttype=1&cm=674%2C742%3B654%2C598%3B615%2C639%3B579%2C634%3B597%2C656%3B587%2C667%3B639%2C797%3B777%2C675%3B624%2C701%3B561%2C709&ck=&cw=0">
                天猫
                </a>&nbsp&nbsp&nbsp
        
        </li>
    
        <li id="inner_li" style="">
        
                <a target="_blank" href="https://c.duomai.com/track.php?site_id=224482&lid=4193&aid=61&euid=lijiaocn&t=http%3A%2F%2Fwww.360buy.com%2F">
                京东
                </a>&nbsp&nbsp&nbsp
        
        </li>
    
        <li id="inner_li" style="">
        
                <a target="_blank" href="https://c.duomai.com/track.php?k=uN2bhlmapxWPklWdlZSMyYTPklWYmAjMzUjMy0DZp9VZ0l2cmYiRyUSbvNmLllma1d2bt5yd3dnRyUiRyUSQzUCc0RHa9QnJ">
                蘑菇街
                </a>&nbsp&nbsp&nbsp
        
        </li>
    
        <li id="inner_li" style="">
        
                <a target="_blank" href="https://p.gouwuke.com/0Rdyy">
                益丰药房
                </a>&nbsp&nbsp&nbsp
        
        </li>
    
        <li id="inner_li" style="">
        
                <details class="topdetails" onmouseover="showmenu(this)" onmouseleave="hiddenmenu(this)">
                    <summary>亚马逊&nbsp&nbsp&nbsp</summary>
                    <ul>
                        
                            <li>
                                <a target="_blank" href="https://amzn.to/2NBHhN7">美国</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://amzn.to/2N0KGzS">日本</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://amzn.to/2zoRl3e">德国</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://amzn.to/2zodOgB">英国</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://amzn.to/2xAksiw">印度</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://amzn.to/2NBHpfz">法国</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://amzn.to/2zoRwvq">意大利</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://amzn.to/2O4YeyF">西班牙</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://amzn.to/2xAksiw">加拿大</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.amazon.cn/?tag=znrio-23">中国</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://amzn.to/2xKqLiP">巴西</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://amzn.to/2DotW60">澳大利亚</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.amazon.com.mx/">墨西哥</a>
                            </li>
                        
                    </ul>
                </details>
            
        </li>
    
        <li id="inner_li" style="">
        
                <details class="topdetails" onmouseover="showmenu(this)" onmouseleave="hiddenmenu(this)">
                    <summary>易趣 1&nbsp&nbsp&nbsp</summary>
                    <ul>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.com/">美国</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.co.uk/">英国</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.de/">德国</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.com.au/">澳大利亚</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.it/">意大利</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.fr/">法国</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.es/">西班牙</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.ca/">加拿大</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.ie/">爱尔兰</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.at/">奥地利</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="http://www.ebay.be/">比利时</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.nl/">荷兰</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.ch/">瑞士</a>
                            </li>
                        
                    </ul>
                </details>
            
        </li>
    
        <li id="inner_li" style="">
        
                <details class="topdetails" onmouseover="showmenu(this)" onmouseleave="hiddenmenu(this)">
                    <summary>易趣 2&nbsp&nbsp&nbsp</summary>
                    <ul>
                        
                            <li>
                                <a target="_blank" href="https://www.gittigidiyor.com/">土耳其</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.pl/">波兰</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.com.hk/">中国香港</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="http://global.gmarket.co.kr/Home/Main">韩国</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.com.sg/">新加坡</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.ph/">菲律宾</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.com.my/">马来西亚</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.in/">印度</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.cn/">中国大陆</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.co.jp/">日本</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.co.th/">泰国</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.vn/">越南</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.com.tw/">台湾</a>
                            </li>
                        
                            <li>
                                <a target="_blank" href="https://www.ebay.se/">瑞典</a>
                            </li>
                        
                    </ul>
                </details>
            
        </li>
    
    </ul>
</div>

<p id="hiddenid" style="color:white;position:absolute;right:15px;top:1px;margin:0;padding:0;font-size:1.2rem;" onclick="hiddenBanner()"></p>
<script>
    function hiddenBanner() {
        var b = document.getElementById("bannerid");
        var p = document.getElementById("hiddenid");
        if (b.style.display=="none"){
            b.style.display="flex";
            p.innerHTML="";
            p.style.color="white"
        }else{
            b.style.display="none";
            p.innerHTML="";
            p.style.color="white"
        }
    }
</script>

    </div>
    <div class="center">
        <div class="leftbar">
            <nav id="nav" class="nav" >
            

<!--details class="menu" open onmouseover="opendetail(this)" -->
<!--details class="menu"-->
<!--details class="menu" open onmouseover="opendetail(this)" -->
<details class="menu" open>
    <summary>鼹鼠看看</summary>
    <ul>
        <li>
            
            <a href="/wechat/news" >全站最新</a>
        </li>
        <li>
            
            <a href="/wechat/about" >本站服务</a>
        </li>
        <li>
            
            <a href="/wechat">鼹鼠首页</a>
        </li>
    </ul>
</details>

<details class="menu" open>
    <summary>精彩连载</summary>
    <ul>
        <li>
            
            <a href="/wechat/tags/specialserial" >最近更新</a>
        </li>
        
        <li>
            
            <a href="/wechat/categories/gh_4c12eeda5979" >灼识新维度</a>
        </li>
        
        <li>
            
            <a href="/wechat/categories/flashsky" >我的安全之路</a>
        </li>
        
    </ul>
</details>

<details class="menu" open>
    <summary>政经启蒙</summary>
    <ul>
        <li>
            
            <a href="/wechat/tags/finacial" >最近更新</a>
        </li>
        
        <li>
            
            <a href="/wechat/categories/worldofboss" >饭统戴老板</a>
        </li>
        
        <li>
            
            <a href="/wechat/categories/Shuiku-net" >水库论坛</a>
        </li>
        
        <li>
            
            <a href="/wechat/categories/wm221x" >猛哥</a>
        </li>
        
        <li>
            
            <a href="/wechat/categories/Shuiku-Off" >水库线下</a>
        </li>
        
        <li>
            
            <a href="/wechat/categories/WatcherCommander" >守夜人总司令</a>
        </li>
        
    </ul>
</details>

<details class="menu" open>
    <summary>互联网</summary>
    <ul>
        <li>
            
            <a href="/wechat/tags/internet" >最近更新</a>
        </li>
        
        <li>
            
            <a href="/wechat/categories/z7z8day" >观点推荐</a>
        </li>
        
        <li>
            
            <a href="/wechat/categories/caozsay" >caoz的梦呓</a>
        </li>
        
        <li>
            
            <a href="/wechat/categories/TOMsInsight" >TOMsInsight</a>
        </li>
        
        <li>
            
            <a href="/wechat/categories/tencent_fsq"  style="color:white;" >腾讯防水墙</a>
        </li>
        
        <li>
            
            <a href="/wechat/categories/WebNotes" >小道消息</a>
        </li>
        
        <li>
            
            <a href="/wechat/categories/ColinHuangZheng" >黄峥</a>
        </li>
        
        <li>
            
            <a href="/wechat/categories/vc-ziliu" >投资人子柳</a>
        </li>
        
        <li>
            
            <a href="/wechat/categories/yirensay" >亦无所知</a>
        </li>
        
    </ul>
</details>


            </nav>
        </div>
        <div class="workspace">
            <style>
    .logo {
        width: 391px;
        width: 39.1rem;
        height: 70px;
        height: 7rem;
        display: flex;
        flex-direction: row;
        justify-content: space-between;
    }
    .logo .logo-font{
        width: 150px;
        width: 15rem;
        height: 70px;
        height: 7rem;
        padding-left: 10px;
        padding-left: 1rem;
        padding-right: 10px;
        padding-right: 1rem;
        background: white;
        font-size: 37px;
        font-size: 3.7rem;
        font-family: "楷体";
        text-align: center;
        display:flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;

    }
    .logo .logo-text{
        width: 200px;
        width: 20rem;
        height: 70px;
        height: 7rem;
        padding-left: 10px;
        padding-left: 1rem;
        padding-right: 10px;
        padding-right: 1rem;
        display: flex;
        flex-direction: column;
        justify-content: center;
        background: white;
    }
    .source {
        width: 351px;
        width: 35.1rem;
        height: 50px;
        height: 5rem;
        background: lightgray;
        display:flex;
        flex-direction: row;
    }
    .source .photo{
        width: 48px;
        width: 4.8rem;
        height: 48px;
        height: 4.8rem;
        padding: 1px;
    }
    .source .detail{
        width: 295px;
        width: 29.5rem;
        padding-left: 5px;
        padding-left: 0.5rem;
        display:flex;
        flex-direction: column;
        align-items: flex-start;
        justify-content: center;
        overflow:hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
    }
    .source .detail .desc{
        font-size:12px;
        font-size:1.2rem;
        overflow:hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
    }
    .source .detail .nick{
        font-size:15px;
        font-size:1.5rem;
        overflow:hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
    }
    .workspace_top{
        display: flex;
        height: auto;
        padding-top: 10px;
        padding-top: 1rem;
        padding-bottom: 10px;
        padding-bottom: 1rem;
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-around;
        background: darkblue;
    }
    @media screen and (max-width: 1020px){
        .source{
            display: none;
        }
    }

    @media screen and (max-width: 750px){
        .workspace_top{
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
        }
        .source{
            display: none;
        }
    }
    @media screen and (max-width: 391px){
        .logo {
            width: 100%;
            padding:0px;
        }
        .logo .logo-font{
            padding:0px;
            font-size: 10vw;
            width: 50%;
        }
        .logo .logo-text{
            padding:0px;
            font-size: 4vw;
            width: 50%;
        }
        .source {
            width: 100%;
            padding:0px;
            margin: 0px;
            display:none;
        }
        .source .photo{
            padding:0px;
            margin: 0px;
        }
        .source .detail{
            width: 80%;
            padding:0px;
            margin: 0px;
        }
        .source .detail .desc{
            width: 100%;
            padding:0px;
            margin: 0px;
        }
        .source .detail .nick{
            width: 100%;
            padding:0px;
            margin: 0px;
        }
    }

</style>
<div style="width: 100%">
 <div class="workspace_top">
     <div class="logo">
        <div class="logo-font">
            <div><a href="/wechat" style="color:black">文章精选</a></div>
        </div>
        <div class="logo-text">
            <div>微信公众号文章精选</div>
            <div><a href="/wechat/">https://www.lijiaocn.com</a></div>
        </div>
     </div>


     <div class="source">
         
         <div class="photo"><a href="/wechat/img/tencent_fsq.photo.png"><img width=100% height=100% src="/wechat/img/tencent_fsq.photo.png"></a></div>
         <div class="detail">
            <div class="nick"><a href="/wechat/categories/tencent_fsq.html"><span>腾讯防水墙/tencent_fsq</span></a></div>
            <div class="desc"><span>腾讯防水墙为您提供专业的业务安全资讯与服务,用领先的技术解决欺诈、薅羊毛、刷单、爬虫、撞库、人机对抗等问题,守护您的业务安全</span></div>
         </div>
     </div>



 </div>
</div>


<div style="width: 100%; text-align: center">
    <h1 style="text-align: center">验证码前端性能分析及优化实践</h1>
    <p style="text-align: center"><span>发布日期：2018-08-16 10:12:01 +0000</span></p>
</div>

<div style="width: 100%; text-align: center">
    <!-- kankan_post_top -->
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-8176866190626448"
         data-ad-slot="8060913530"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

<div class="article">
    <div style="display:flex; flex-direction: row; justify-content: space-between">
        
        <li class="previous">
            <a href="/tencent_fsq/2018/10/22/tencent_fsq-2256/">前一篇</a>
        </li>
        

        <div class="postinfo" style="text-align:center;color:gray">
            
            
            <span><a href="/wechattags/internet">internet</a> / <a href="/wechatcategories/tencent_fsq">腾讯防水墙</a></span>
        </div>

        
        <li class="next">
            <a href="/tencent_fsq/2018/08/13/tencent_fsq-2258/">后一篇</a>
        </li>
        

    </div>

    <div><div class="rich_media_content" id="js_content">
<p>
<img class="" data-copyright="0" data-ratio="0.1334723670490094" data-s="300,640" data-src="" data-type="png" data-w="959" src="/wechat/img/kEQaY0b2qU00NhCuqbvazwICJskdmtGLmgqIiaEYmB2FvfthQ2qj2iaa2nbiaqfjM5PM7LQ2yhck5eTdKoicBeUrqg.png" style="" />
</p>
<p style="white-space: normal;max-width: 100%;min-height: 1em;color: rgb(51, 51, 51);text-align: center;">
<span style="font-size: 14px;max-width: 100%;color: rgb(178, 178, 178);box-sizing: border-box !important;word-wrap: break-word !important;">
<br />
</span>
</p>
<p style="white-space: normal;max-width: 100%;min-height: 1em;color: rgb(51, 51, 51);text-align: center;">
<span style="max-width: 100%;color: rgb(178, 178, 178);font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">
          点击上方蓝字关注腾讯防水墙
         </span>
</p>
<p style="white-space: normal;max-width: 100%;min-height: 1em;color: rgb(51, 51, 51);text-align: center;">
<span style="max-width: 100%;color: rgb(178, 178, 178);font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">
          了解第一手企业安全资讯
         </span>
</p>
<p style="white-space: normal;max-width: 100%;min-height: 1em;color: rgb(51, 51, 51);text-align: center;">
<span style="max-width: 100%;color: rgb(178, 178, 178);font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">
<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;" />
</span>
</p>
<p style="white-space: normal;max-width: 100%;min-height: 1em;color: rgb(51, 51, 51);text-align: center;">
<span style="max-width: 100%;color: rgb(214, 214, 214);font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">
          /  /  /  /  /  /  /  /  /  /  /
         </span>
</p>
<p style="white-space: normal;max-width: 100%;min-height: 1em;color: rgb(51, 51, 51);text-align: center;">
<span style="max-width: 100%;color: rgb(214, 214, 214);font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">
<br />
</span>
</p>
<blockquote>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
           在越来越注重用户体验的趋势下，验证码作为一种自打诞生以来就被贴上“多余”标签的产品，更应该给用户提供良好的体验。本文以滑动验证码作为切入点，分析了验证码可能存在的性能问题，并通过资源合并、DOM操作优化和选择性内联打包等方式有效减少页面加载时间。同时本文总结了移动端组件化适配容易遇到的问题，并提供了规范化的解决方案。希望本文能给前端做性能优化的同学提供一些不一样的实践思路。
           <span style="font-size: 14px;caret-color: rgb(0, 0, 0);">
</span>
</span>
</p>
</blockquote>
<p>
<br />
</p>
<p>
<br />
</p>
<h1 style=";">
<strong>
<span style="font-size: 20px;">
           1. 验证码现状
          </span>
</strong>
</h1>
<p>
<strong>
<span style="font-size: 20px;">
<br />
</span>
</strong>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          优化前，我们优先对现有验证码进行了分析，总结其存在的主要问题。
         </span>
</p>
<ul class="list-paddingleft-2" style="">
<li>
<p>
<span style="font-size: 14px;">
            资源乱象
           </span>
</p>
</li>
<li>
<p>
<span style="font-size: 14px;">
            无节制的DOM及异步等待
           </span>
</p>
</li>
<li>
<p>
<span style="font-size: 14px;">
            移动端适配不规范
           </span>
</p>
</li>
</ul>
<p>
<br />
</p>
<h3 style=";">
<span style="font-size: 18px;">
<strong>
           资源乱象
          </strong>
</span>
</h3>
<p>
<span style="font-size: 18px;">
<strong>
<br />
</strong>
</span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          资源乱象是老旧工程普遍存在的问题，作为jQuery时代遗留下来的验证码工程，该现象同样存在。表1.1展现了旧版验证码资源文件情况，从表中可以看出，旧版验证码资源使用相对混乱，尤其是js/css资源，分散的多个小文件大大增加了HTTP请求数量。验证码的图片资源都是一些小图标，虽然前期的一些优化已经将这些小图标合并成雪碧图，但对于少量的小图标仍然有优化空间。
         </span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<br />
</p>
<p style="text-align: center;">
<img class="" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz_png/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWo33gcXbbSkianzyYS9zIVXsxbrCTH8nQxForJNO2O4nBIb6Qq4a280ZA/0?wx_fmt=png" data-copyright="0" data-ratio="0.8125" data-s="300,640" data-src="" data-type="png" data-w="448" src="/wechat/img/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWo33gcXbbSkianzyYS9zIVXsxbrCTH8nQxForJNO2O4nBIb6Qq4a280ZA.png" style="width: 238px;height: 193px;" />
</p>
<p style="text-align: center;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
          表1.1 验证码前端资源文件分布
         </span>
</p>
<p style="text-align: center;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
<br />
</span>
</p>
<p style="text-align: left;">
<span style="font-size: 18px;">
<strong>
           无节制的DOM及异步等待
          </strong>
</span>
</p>
<p style="text-align: left;">
<br />
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          验证码拥有诸多定制化能力，包括弹出形式、多语言、主题色、头部和反馈按钮等，旧版验证码为了实现定制化能力进行了大量冗余的DOM操作，不仅消耗性能，而且加载过程会出现界面闪烁。同时旧版验证码为了解决一些异步等待的问题，引入了诸多定时器，看似无脑，却大大增加了逻辑复杂度，使得代码难以维护。
         </span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<br />
</p>
<h3 style=";">
<span style="font-size: 18px;">
<strong>
           移动端适配不规范
          </strong>
</span>
</h3>
<p>
<span style="font-size: 14px;">
<br />
</span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          旧版验证码未进行体系化的移动端适配，所有适配的样式均为js实时计算完成后写入DOM的style中，逻辑复杂。此前收到诸多用户反馈均与此适配方式有关，前端经常需要为了适配某一种机型而堆叠代码，苦不堪言。
         </span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
<br />
</span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<strong>
<span style="font-size: 14px;">
           面临着如此多的历史包袱，重构势在必行。
          </span>
</strong>
</p>
<p>
<br />
</p>
<p>
<br />
</p>
<h1 style=";">
<span style="font-size: 20px;">
<strong>
           2. 方案及技术选型
          </strong>
</span>
</h1>
<p>
<span style="font-size: 20px;">
<strong>
<br />
</strong>
</span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          图2.1是验证码的前端框架，验证码的主要页面使用iframe加载，iframe隔离了业务页面，为验证码提供了更可控更干净的执行环境。业务页面接入时需要引入一个验证码的入口js，该js负责分配不同类型的验证码、创建iframe，并管理iframe与业务页面的通信。
         </span>
</p>
<p>
<br />
</p>
<p style="text-align: center;">
<img class="" data-backh="363" data-backw="558" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz_png/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWoMZAHUCicAmlFbFRUjD65WGrJ23ApKvb262463KUtJ0Kfjw7GicBcmfPA/640?wx_fmt=png" data-copyright="0" data-ratio="0.65" data-s="300,640" data-src="" data-type="png" data-w="1200" src="/wechat/img/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWoMZAHUCicAmlFbFRUjD65WGrJ23ApKvb262463KUtJ0Kfjw7GicBcmfPA.png" style="width: 100%;height: auto;" />
</p>
<p style="text-align: center;">
<span style="font-size: 14px;">
          图2.1 验证码前端框架
         </span>
</p>
<p style="text-align: left;">
<br />
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          任何完全推翻原有架构的重构都是耍流氓。验证码重构的原则是保持原有的业务逻辑，只重构前端实现。因此本次重构将围绕绿色iframe部分进行，其他部分保持不变，这样既能保证业务平滑过渡，也能让原有测试样例完整覆盖。
         </span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<br />
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          一个项目能否具备良好的可维护性，前期技术选型尤为重要。重构前，基于对验证码整体功能的评估，最终将整体优化方案划分为3个部分。本文也将围绕这3个部分，讲述验证码前端性能优化的思考及方案。
         </span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
<br />
</span>
</p>
<ol class="list-paddingleft-2" style="list-style-type: lower-alpha;">
<li>
<p>
<span style="font-size: 14px;">
<strong>
             资源合并
            </strong>
</span>
</p>
</li>
<ul class="list-paddingleft-2" style="list-style-type: disc;">
<li>
<p>
<span style="font-size: 14px;">
             模块化
            </span>
</p>
</li>
<li>
<p>
<span style="font-size: 14px;">
             DOM操作优化
            </span>
</p>
</li>
<li>
<p>
<span style="font-size: 14px;">
             资源合并打包
            </span>
</p>
</li>
<li>
<p>
<span style="font-size: 14px;">
             图片、样式内联
            </span>
</p>
</li>
<p>
<br />
</p>
</ul>
<li>
<p>
<span style="font-size: 14px;">
<strong>
             规范移动端适配
            </strong>
</span>
</p>
</li>
<ul class="list-paddingleft-2" style="list-style-type: disc;">
<li>
<p>
<span style="font-size: 14px;">
             引入flexible.js
            </span>
</p>
</li>
<li>
<p>
<span style="font-size: 14px;">
             rem自动换算
            </span>
</p>
</li>
<li>
<p>
<span style="font-size: 14px;">
             iframe内缩放问题
            </span>
</p>
</li>
<li>
<p>
<span style="font-size: 14px;">
             webview内适配问题
            </span>
</p>
</li>
<p>
<br />
</p>
</ul>
<li>
<p>
<span style="font-size: 14px;">
<strong>
             提升用户预期
            </strong>
</span>
</p>
</li>
</ol>
<p>
<strong>
<span style="font-size: 18px;">
<br />
</span>
</strong>
</p>
<p>
<strong>
<span style="font-size: 18px;">
<br />
</span>
</strong>
</p>
<h1 style=";">
<strong>
<span style="font-size: 20px;">
           3. 资源合并
          </span>
</strong>
</h1>
<p>
<strong>
<span style="font-size: 20px;">
<br />
</span>
</strong>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          资源合并是一个很大的方向，不同的产品合并方式各不相同。如图3.1所示，是整个验证码的加载流程，绿框内的节点为本次优化需要关注的阶段。
         </span>
</p>
<p>
<br />
</p>
<p style="text-align: center;">
<img class="" data-backh="117" data-backw="558" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz_png/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWoHOCC5Qib5licjjUX0qyawgoic6YibaSXe2dpzKmWRKlnl8ZbiceeP1XNLYg/640?wx_fmt=png" data-copyright="0" data-ratio="0.20971867007672634" data-s="300,640" data-src="" data-type="png" data-w="1564" src="/wechat/img/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWoHOCC5Qib5licjjUX0qyawgoic6YibaSXe2dpzKmWRKlnl8ZbiceeP1XNLYg.png" style="width: 100%;height: auto;" />
</p>
<p style="text-align: center;">
<span style="font-size: 14px;">
          图3.1 验证码加载流程
         </span>
</p>
<p style="text-align: center;">
<br />
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
          重构前我们对各阶段耗时进行了分析，其中DOM渲染和验证码主逻辑耗时占比相对较高，属于需要重点优化的部分。而验证码类型请求、iframe创建、iframe请求和图片加载与浏览器性能及服务端响应相关，因此暂时不进行优化，后期考虑预加载。
         </span>
</p>
<p style="text-align: center;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
</span>
</p>
<p style="text-align: center;">
<img class="" data-backh="278" data-backw="558" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz_png/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWow5rdbtnibNWc55COffFflmgkAmAcqHMLLqAcYaMoG1VOLFGibR6Jrn5A/640?wx_fmt=png" data-copyright="0" data-ratio="0.4983388704318937" data-s="300,640" data-src="" data-type="png" data-w="1204" src="/wechat/img/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWow5rdbtnibNWc55COffFflmgkAmAcqHMLLqAcYaMoG1VOLFGibR6Jrn5A.png" style="width: 100%;height: auto;" />
</p>
<p style="text-align: center;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
          图3.2 验证码加载时间
         </span>
</p>
<p style="text-align: center;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
<br />
</span>
</p>
<h3 style=";">
<strong>
<span style="font-size: 18px;">
           3.1 模块化
          </span>
</strong>
</h3>
<p>
<strong>
<span style="font-size: 18px;">
<br />
</span>
</strong>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          从加载流程可以看出，验证码并不是一个简单的几十上百行代码就能实现的工程，复杂的逻辑需要分模块才能更好地管理团队分工和整体进度，模块化也有利于单元测试，保证工程的质量。然而，JavaScript并不是一种模块化编程语言，其模块化需要依赖额外的工具实现。早期的模块化有多种不同的写法，想要详细了解的读者可阅读阮一峰老师的《Javascript模块化编程（一）：模块的写法》。
         </span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
<br />
</span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          模块化发展的中期，require.js和sea.js占据了模块化解决方案的半壁江山，这两个方案都是对模块化很好的实践。验证码将采用Node.js模块系统的CommonJS规范，借助webpack4将模块打包到一起。最终验证码工程中模块引用及导出相关的代码非常简单：
         </span>
</p>
<pre class="language-text" style=";"><code class="language-text" style=";"><span style="box-sizing: border-box;font-size: 14px;color: rgb(107, 107, 184);line-height: inherit;font-family: Consolas, Inconsolata, Courier, monospace;white-space: pre;word-wrap: inherit !important;word-break: inherit !important;"></span></code></pre>
<pre style="box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: inherit;color: inherit;line-height: inherit;"><code class="hljs javascript" style="box-sizing: border-box;margin-right: 2px;margin-left: 2px;padding: 0.5em;font-size: 14px;color: rgb(169, 183, 198);line-height: 18px;border-radius: 0px;background: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;display: block;overflow-x: auto;letter-spacing: 0px;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;"><span class="hljs-keyword" style="box-sizing: border-box;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">const</span> module1 = <span class="hljs-built_in" style="box-sizing: border-box;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">require</span>(<span class="hljs-string" style="box-sizing: border-box;font-size: inherit;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'./module1'</span>);<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;" /><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;" /><span class="hljs-comment" style="box-sizing: border-box;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">// ...</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;" /><span class="hljs-function" style="box-sizing: border-box;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="word-wrap: inherit !important;word-break: inherit !important;">function</span> <span class="hljs-title" style="line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">Captcha</span>(<span class="hljs-params" style="line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></span>) </span>{}<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;" /><span class="hljs-comment" style="box-sizing: border-box;font-size: inherit;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">// ...</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;" /><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;" /><span class="hljs-built_in" style="box-sizing: border-box;font-size: inherit;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">module</span>.exports = Captcha;<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;" /></code></pre>
<p>
<br />
<label style="box-sizing: border-box;">
</label>
</p>
<p style="text-align: left;">
<span style="font-size: 14px;caret-color: rgb(0, 0, 0);">
          模块化是资源合并的基础，这里的模块化不仅是将业务逻辑分模块加载，也包含了CSS、Icon等样式和图标。只有把所有资源均纳入到模块化管理中，配合webpack不同的loader，才能更细粒度地控制合并资源。
          <br />
</span>
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
<br />
</span>
</p>
<h3 style=";">
<span style="font-size: 18px;">
<strong>
           3.2 DOM操作优化
          </strong>
</span>
</h3>
<p>
<span style="font-size: 18px;">
<strong>
<br />
</strong>
</span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          DOM操作是整个JavaScript执行周期中最耗时的操作之一，不合理的DOM操作不仅会触发页面大量的重排和重绘，还有可能导致页面假死。良好的DOM组织结构应该遵循不需要大量重排（Reflow），DOM修改尽量用重绘（Repaint）代替的原则。
         </span>
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
<br />
</span>
</p>
<p style="text-align: center;">
<img class="" data-backh="258" data-backw="558" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz_png/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWoAWxuxmp3wkFaCMbcCMSx6SFuOyolXicPRaK47oP1iaRYEiaK74SmFbplg/640?wx_fmt=png" data-copyright="0" data-ratio="0.4630225080385852" data-s="300,640" data-src="" data-type="png" data-w="1244" src="/wechat/img/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWoAWxuxmp3wkFaCMbcCMSx6SFuOyolXicPRaK47oP1iaRYEiaK74SmFbplg.png" style="width: 100%;height: auto;" />
</p>
<p style="text-align: center;">
<span style="font-size: 14px;">
          图3.3 重绘&amp;重排
          <span style="font-size: 14px;caret-color: rgb(0, 0, 0);">
</span>
<br />
</span>
</p>
<p style="text-align: center;">
<br />
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          重绘是指一个元素的外观被改变，但布局没有发生变化，包括改变visibility、outline、background等属性；而重排是DOM的变化影响了元素的几何属性，浏览器会重新计算元素的几何属性，使渲染树中受到影响的部分失效，会验证DOM树上的所有其它节点的visibility属性，十分低效，这类操作包括改变窗口大小、文字大小、内容，style属性等。
         </span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<br />
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          本次重构针对旧版工程大量不合理的DOM操作进行优化，采取的解决方案包括：
         </span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<br />
</p>
<ul class="list-paddingleft-2" style="list-style-type: disc;">
<li>
<p>
<strong>
<span style="font-size: 14px;">
             最小化重绘和重排
            </span>
</strong>
</p>
<p>
<span style="font-size: 14px;">
            重新合理组织了DOM结构，将DOM的多样化用CSS类的方式表示，尽量控制DOM的显示或隐藏，避免添加或删除，对于一些要修改的DOM结构，采用修改className的方式，而不是多次读写style，避免使用js修复布局，减小DOM操作对页面渲染造成的影响。
           </span>
</p>
</li>
</ul>
<p>
<br />
</p>
<ul class="list-paddingleft-2" style="">
<li>
<p>
<strong>
<span style="font-size: 14px;">
             缓存DOM元素
            </span>
</strong>
</p>
<p>
<span style="font-size: 14px;">
            如果某个节点将在后续进行多次操作，则将其利用变量存储起来，而不是每次进行操作时都去查找一遍该节点。
           </span>
</p>
</li>
</ul>
<p style="white-space: normal;">
<br />
</p>
<ul class="list-paddingleft-2" style="">
<li>
<p>
<strong>
<span style="font-size: 14px;">
             消灭定时器
            </span>
</strong>
</p>
<p>
<span style="font-size: 14px;">
            对于一些动画效果的实现，避免使用setTimeout或setInterval，而是用requestAnimationFrame代替
           </span>
</p>
</li>
</ul>
<p>
<br />
</p>
<h3 style=";">
<span style="font-size: 18px;">
<strong>
           3.3 资源合并打包
          </strong>
</span>
</h3>
<p>
<span style="font-size: 18px;">
<strong>
<br />
</strong>
</span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          js脚本的加载和执行会阻塞HTML Parser，本次优化本着"all in one"的原则，运用组件化思想，将复杂的逻辑抽象成多个独立的模块，把前端代码拆分成多个小文件，利用webpack灵活地处理模块依赖、提取公共模块最终合成业务所需代码。通过webpack-bundle-analyzer插件将打包后的内容束展示为方便交互的直观树状图，如图3.4所示:
         </span>
</p>
<p>
<br />
</p>
<p style="text-align: center;">
<img class="" data-backh="426" data-backw="558" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz_png/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWoT5tbxxEH3ff27hGHEcicQ1kG6Ioicv94wOtkMMNMPBO0ibFNIAaziciceicA/640?wx_fmt=png" data-copyright="0" data-ratio="0.7642079806529625" data-s="300,640" data-src="" data-type="png" data-w="1654" src="/wechat/img/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWoT5tbxxEH3ff27hGHEcicQ1kG6Ioicv94wOtkMMNMPBO0ibFNIAaziciceicA.png" style="width: 100%;height: auto;" />
</p>
<p style="text-align: center;">
<span style="font-size: 14px;">
          图3.4 验证码项目结构
         </span>
</p>
<p style="text-align: center;">
<br />
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
          滑动验证码支持20多个国家的23种语言，文案数多达30余条，因此语言包的体积占了整个工程的很大比例。Zepto有很多模块，通常为了使引用的zepto库尽可能小，会根据项目的实际需要打包所需的模块进去，验证码项目只需用到事件处理、网络请求和一些简单的动画效果，因此我们对zepto、event、ajax和fx（动画模块）四个模块进行了打包处理，生成本项目特有的zepto库。整个项目结构中占用体积较大的js来自多语言包和zepto库，其余都是体积可忽略不计的小组件。
         </span>
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
<br />
</span>
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
          通过webpack对js的模块化管理，整个项目的模块结构变得十分清晰，方便维护和重构。Js资源文件的数量由10余个减小为1个，体积也得到了很好的控制，减少了HTTP请求数量并且没有增加带宽消耗。
         </span>
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
<br />
</span>
</p>
<h3 style=";">
<strong>
<span style="font-size: 18px;">
           3.4 图片、样式内联
          </span>
</strong>
</h3>
<p>
<strong>
<span style="font-size: 18px;">
<br />
</span>
</strong>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          验证码中的图片均为Icon，特点是体积小但数量较多，合并成雪碧图后还是需要占用几十KB的空间，并且加载雪碧图需要一次额外的HTTP请求。针对验证码小图标众多这一特性，我们将这些小图标base64编码到css文件中，减少HTTP请求数量，并且并不会占用很大的空间。
         </span>
</p>
<section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;">
<pre style="font-size: inherit;color: inherit;line-height: inherit;margin-top: 0px;margin-bottom: 0px;padding: 0px;"><code class="hljs bash" style="margin-right: 2px;margin-left: 2px;line-height: 18px;font-size: 14px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;display: block !important;word-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span class="hljs-built_in" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">test</span>: /\.(png|jpg|gif)$/,<br />use: [{<br />    loader: <span class="hljs-string" style="font-size: inherit;line-height: inherit;color: rgb(238, 220, 112);word-wrap: inherit !important;word-break: inherit !important;">'url-loader'</span>,<br />    options: {<br />        <span class="hljs-built_in" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">limit</span>: 8192<br />    }<br />}]</code></pre>
</section>
<p style="text-align: left;">
<br />
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          在工程中添加上述webpack配置，采用url-loader插件自动对小于8KB的小图标进行DataURL处理，直接把图片资源内嵌到页面中提供给浏览器解析，这样就可以不用发送HTTP请求，提升资源文件加载速度的同时也节省了带宽资源。
         </span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<br />
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          验证码的DOM结构并不算太复杂，并且经过对SCSS的模块化处理，使用PostCSS生态和cssnext来支持自定义变量、样式内嵌等特性，最终编译生成的CSS文件已经很简洁，体积只有十几KB，因此我们考虑不再将其作为一个单独的资源文件引用，而是直接将其inline到html中，在html的head标签中添加如下style配置：
         </span>
</p>
<section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;">
<pre style="font-size: inherit;color: inherit;line-height: inherit;margin-top: 0px;margin-bottom: 0px;padding: 0px;"><code class="hljs xml" style="margin-right: 2px;margin-left: 2px;line-height: 18px;font-size: 14px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;display: block !important;word-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span class="hljs-tag" style="font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&lt;<span class="hljs-name" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">style</span> <span class="hljs-attr" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">type</span>=<span class="hljs-string" style="font-size: inherit;line-height: inherit;color: rgb(238, 220, 112);word-wrap: inherit !important;word-break: inherit !important;">"text/css"</span>&gt;&lt;<span class="hljs-name" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">%=</span> <span class="hljs-attr" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">compilation.assets</span>[<span class="hljs-attr" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">htmlWebpackPlugin.files.css</span>[<span class="hljs-attr" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">0</span>]<span class="hljs-attr" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">.substr</span>(<span class="hljs-attr" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">htmlWebpackPlugin.files.publicPath.length</span>)]<span class="hljs-attr" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">.source</span>() %&gt;&lt;/<span class="hljs-name" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">style</span>&gt;</span><br /></code></pre>
</section>
<p style="caret-color: rgb(0, 0, 0);">
<br />
<span style="font-size: 14px;">
</span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          webpack的compilation对象继承于compiler，能获取一切编译后的内容，因此可以直接把打包生成的css样式插入html，减少了额外的HTTP请求，并且能避免偶发的CDN资源加载失败导致的页面显示异常。
         </span>
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
<br />
</span>
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
<br />
</span>
</p>
<h1 style=";">
<strong>
<span style="font-size: 20px;">
           4. 移动端适配
          </span>
</strong>
</h1>
<p>
<strong>
<span style="font-size: 20px;">
<br />
</span>
</strong>
</p>
<h3 style=";">
<span style="font-size: 18px;">
<strong>
           4.1 引入flexible.js
          </strong>
</span>
</h3>
<p>
<span style="font-size: 18px;">
<strong>
<br />
</strong>
</span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          flexible.js是一个开源的用于终端设备的适配解决方案，主要用于解决各种不同尺寸移动设备的大小自适应问题，其原理是通过移动设备的dpr（设备像素比=物理像素/设备独立像素）和屏幕宽度来动态改变html的font-size大小。因此我们选择flexible.js用于验证码的页面适配，在页面引入flexible.js后，首先获取设备型号，然后根据不同设备在标签上添加一个data-dpr和font-size样式，并结合我们的项目对其进行改进，获得更加完美的兼容效果。
         </span>
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
<br />
</span>
</p>
<h3 style=";">
<span style="font-size: 18px;">
<strong>
           4.2 rem自动换算
          </strong>
</span>
</h3>
<p>
<span style="font-size: 18px;">
<strong>
<br />
</strong>
</span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          下面是验证码页面的缩放配置，其中，baseDpr表示基准的dpr值为1，rem单位以375宽度的屏幕为基准，即1rem==37.5px，并提供'!px'和'!no'两种特殊的单位转换方式。
         </span>
</p>
<section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;">
<pre style="font-size: inherit;color: inherit;line-height: inherit;margin-top: 0px;margin-bottom: 0px;padding: 0px;"><code class="hljs cs" style="margin-right: 2px;margin-left: 2px;line-height: 18px;font-size: 14px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;display: block !important;word-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span class="hljs-comment" style="font-size: inherit;line-height: inherit;color: rgb(128, 128, 128);word-wrap: inherit !important;word-break: inherit !important;">// px2rem</span><br /><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">const</span> px2remConfigs = {<br />    baseDpr: <span class="hljs-number" style="font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">1</span>,<br />    remUnit: <span class="hljs-number" style="font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">37.5</span>,<br />    forcePxComment: <span class="hljs-string" style="font-size: inherit;line-height: inherit;color: rgb(238, 220, 112);word-wrap: inherit !important;word-break: inherit !important;">'!px'</span>,<br />    keepComment: <span class="hljs-string" style="font-size: inherit;line-height: inherit;color: rgb(238, 220, 112);word-wrap: inherit !important;word-break: inherit !important;">'!no'</span><br />};</code></pre>
</section>
<p style="text-align: left;">
<br />
</p>
<p style="text-align: left;">
<span style="font-size: 14px;caret-color: rgb(0, 0, 0);">
          通过postcss-loader的px2rem插件将原生scss文件中所有用px单位表示的大小自动编译转换成能够自适应于各屏幕大小的rem值。同时，会对px后面带'!px'和'!no'后缀的情况做特殊处理，在px后面添加'!px'表示根据dpr设置成不同的rem值，一般字体用该单位修饰；在px后面添加'!no'表示不转化px直接原样输出，一般boder边框用该单位修饰。
          <br />
</span>
</p>
<section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;">
<pre style="font-size: inherit;color: inherit;line-height: inherit;margin-top: 0px;margin-bottom: 0px;padding: 0px;"><code class="hljs css" style="margin-right: 2px;margin-left: 2px;line-height: 18px;font-size: 14px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;display: block !important;word-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span class="hljs-selector-tag" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">loader</span>: "<span class="hljs-selector-tag" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">postcss-loader</span>",<br /><span class="hljs-selector-tag" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">options</span>: {<br />    <span class="hljs-attribute" style="font-size: inherit;line-height: inherit;color: rgb(238, 220, 112);word-wrap: inherit !important;word-break: inherit !important;">plugins</span>: [<br />        autoprefixer, // 自动添加前缀<br />        <span class="hljs-built_in" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">px2rem</span>(px2remConfigs)<br />    ]<br />}<br /></code></pre>
</section>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
<br />
</span>
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
          针对一些元素尺寸、位置等需要动态变化的情况，比如横竖屏切换时iframe整体大小需要自适应，再比如每刷新一次，小拼图的宽、高、top值都要重新计算，此时只需要注册相应的回调函数，在回调函数内进行相应的逻辑处理即可。flexible检测到resize、pageshow或其它调用refreshRem方法的时候，会回调在验证码内注册的回调数组（resizeCb)中的所有方法。
         </span>
</p>
<section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;">
<pre style="font-size: inherit;color: inherit;line-height: inherit;margin-top: 0px;margin-bottom: 0px;padding: 0px;"><code class="hljs php" style="margin-right: 2px;margin-left: 2px;line-height: 18px;font-size: 14px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;display: block !important;word-wrap: normal !important;word-break: normal !important;overflow: auto !important;">listen: <span class="hljs-function" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">function</span><span class="hljs-params" style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);word-wrap: inherit !important;word-break: inherit !important;">(order, cb)</span> </span>{<br />    <span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span>(flexible.resizeCb) {<br />        flexible.resizeCb.splice(order, <span class="hljs-number" style="font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">0</span>, cb);<br />    }<br />}<br />flexible.listen(<span class="hljs-number" style="font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">0</span>, <span class="hljs-function" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">function</span><span class="hljs-params" style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);word-wrap: inherit !important;word-break: inherit !important;">()</span> </span>{...};<br />flexible.listen(<span class="hljs-number" style="font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">1</span>, <span class="hljs-function" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">function</span><span class="hljs-params" style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);word-wrap: inherit !important;word-break: inherit !important;">()</span> </span>{...};<br />flexible.listen(<span class="hljs-number" style="font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">2</span>, <span class="hljs-function" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">function</span><span class="hljs-params" style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);word-wrap: inherit !important;word-break: inherit !important;">()</span> </span>{...};<br />...<br /><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span>(flexible.resizeCb) {<br />    <span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">for</span>(<span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">var</span> i=<span class="hljs-number" style="font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">0</span>; i &lt; flexible.resizeCb.length; i++) {<br />        <span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">try</span>{<br />            flexible.resizeCb[i] &amp;&amp; flexible.resizeCb[i]();<br />        } <span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">catch</span>(e) {}<br />    }<br />}<br /></code></pre>
</section>
<p style="text-align: left;">
<br />
</p>
<h3 style=";">
<span style="font-size: 18px;">
<strong>
           4.3 iframe内缩放问题
          </strong>
</span>
</h3>
<p>
<span style="font-size: 18px;">
<strong>
<br />
</strong>
</span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          验证码作为一个web组件提供给业务使用，在iframe内部默认不设置视口（viewport），在dpr大于1的时候整个iframe会被压缩成1/dpr，如图4.1左侧所示。因此需要根据业务页面设置的viewport来设置缩放比例，通过获取父页面的scale值并将其透传到iframe内部的方式来设置正确的缩放比例，最终得到如图4.1右侧所示的效果。
         </span>
</p>
<p style="text-align: left;">
<br />
</p>
<p style="text-align: center;">
<img class="" data-backh="315" data-backw="558" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz_png/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWopCibmqsy9T7vOZKqQh5QAHiar3rIOxvRTL9yjesFLzLjtiadjSyUIW0vQ/640?wx_fmt=png" data-copyright="0" data-ratio="0.565028901734104" data-s="300,640" data-src="" data-type="png" data-w="1384" src="/wechat/img/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWopCibmqsy9T7vOZKqQh5QAHiar3rIOxvRTL9yjesFLzLjtiadjSyUIW0vQ.png" style="width: 100%;height: auto;" />
</p>
<p style="text-align: center;">
<span style="font-size: 14px;">
          图4.1 iframe内缩放问题
         </span>
</p>
<p style="text-align: center;">
<br />
</p>
<h3 style=";">
<span style="font-size: 18px;">
<strong>
           4.4 webview内适配问题
          </strong>
</span>
</h3>
<p>
<span style="font-size: 18px;">
<strong>
<br />
</strong>
</span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          虽然flexible能比较完美地适配移动端页面，然而在一些特殊的安卓机器中仍然会存在很诡异的适配问题，如图4.2所示：
         </span>
</p>
<p style="text-align: left;">
<br />
</p>
<p style="text-align: center;">
<img class="" data-backh="463" data-backw="558" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz_png/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWo0zaovlVnk7gp9RwibvVcV8P2zU81un96QfUA5HrEsqeyr97aNRDEn0A/640?wx_fmt=png" data-copyright="0" data-ratio="0.8298245614035088" data-s="300,640" data-src="" data-type="png" data-w="1140" src="/wechat/img/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWo0zaovlVnk7gp9RwibvVcV8P2zU81un96QfUA5HrEsqeyr97aNRDEn0A.png" style="width: 100%;height: auto;" />
</p>
<p style="text-align: center;">
<span style="font-size: 14px;">
          图4.2 webview内适配问题
         </span>
</p>
<p style="text-align: center;">
<br />
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
          产生这种情况的原因是安卓部分webview修改了默认字体，使得最终显示的1rem的px值和设置的值不一致，导致页面显示异常。正常情况下，rem是根据html的最终font-size进行响应的，并且对于大部分机型，设置的值和最终的响应值是相等的，即：
         </span>
</p>
<section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;">
<pre style="font-size: inherit;color: inherit;line-height: inherit;margin-top: 0px;margin-bottom: 0px;padding: 0px;"><code class="hljs ini" style="margin-right: 2px;margin-left: 2px;line-height: 18px;font-size: 14px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;display: block !important;word-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span class="hljs-attr" style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);word-wrap: inherit !important;word-break: inherit !important;">1rem</span> == finalDocElementFontSize == docElementFontSize<br /></code></pre>
</section>
<p style="text-align: left;">
<br />
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
          然而在小米MAX和荣耀8等机型中，最终的响应值要大于设置的值，导致以rem为单位的DOM元素都显示过大，就会出现图4.2中小拼图缺口大小不匹配、图片超出屏幕区域的异常情况。
         </span>
</p>
<p style="text-align: center;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
<br />
</span>
</p>
<p style="text-align: center;">
<img class="" data-backh="138" data-backw="558" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz_png/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWoo053zen8BXZdAT808E4YH20HVCzyZPickw75LVJibRXzkDEAEd18R3uA/640?wx_fmt=png" data-copyright="0" data-ratio="0.24775583482944344" data-s="300,640" data-src="" data-type="png" data-w="1114" src="/wechat/img/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWoo053zen8BXZdAT808E4YH20HVCzyZPickw75LVJibRXzkDEAEd18R3uA.png" style="width: 100%;height: auto;" />
</p>
<p style="text-align: center;">
<span style="font-size: 14px;caret-color: rgb(0, 0, 0);">
          表4.1 优化前后采集数据对比
         </span>
</p>
<p style="text-align: center;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
<br />
</span>
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
          如表4.1所示，其中，优化前所在行是我们采集上来的异常数据，可以明显看到，真实的1rem对应的px值要远大于设置的值，此时设定一个阈值，当设置值和最终响应值差值大于0.5时，重新计算fontsize大小：
         </span>
</p>
<section class="output_wrapper" style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;">
<pre style="font-size: inherit;color: inherit;line-height: inherit;margin-top: 0px;margin-bottom: 0px;padding: 0px;"><code class="hljs javascript" style="margin-right: 2px;margin-left: 2px;line-height: 18px;font-size: 14px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;display: block !important;word-wrap: normal !important;word-break: normal !important;overflow: auto !important;"><span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">try</span> {<br />    <span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">var</span> finalDocElementFontSize = <span class="hljs-built_in" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">parseFloat</span>(getComputedStyle(docEl).fontSize);<br />    <span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">if</span>(<span class="hljs-built_in" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">Math</span>.abs(finalDocElementFontSize - docElementFontSize) &gt; <span class="hljs-number" style="font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);word-wrap: inherit !important;word-break: inherit !important;">0.5</span>) {<br />        <span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">var</span> delta = finalDocElementFontSize / docElementFontSize;<br />        docEl.style.fontSize = (docElementFontSize / delta) + <span class="hljs-string" style="font-size: inherit;line-height: inherit;color: rgb(238, 220, 112);word-wrap: inherit !important;word-break: inherit !important;">'px'</span>;<br />    }<br />} <span class="hljs-keyword" style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);word-wrap: inherit !important;word-break: inherit !important;">catch</span>(e) {}<br /></code></pre>
</section>
<p style="text-align: left;">
<br />
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
          得到矫正后的优化后数据，使得最终的响应值接近我们最初想要设置的值，页面就能达到如图4.3所示完美的适配效果：
         </span>
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
<br />
</span>
</p>
<p style="text-align: center;">
<img class="" data-copyright="0" data-ratio="1.6851063829787234" data-s="300,640" data-src="" data-type="png" data-w="470" src="/wechat/img/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWo2Kb41KOewwrfzlUGeJUampDLholdlzWkjfDI7QoJzMw5k9XUe1Pl1A.png" style="width: 210px;height: 354px;" />
</p>
<p style="text-align: center;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
          图4.3 优化后适配效果
         </span>
</p>
<p style="text-align: center;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
<br />
</span>
</p>
<h1 style=";">
<span style="font-size: 20px;">
<strong>
           5. 提升用户预期
          </strong>
</span>
</h1>
<p>
<span style="font-size: 20px;">
<strong>
<br />
</strong>
</span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          图5.1是旧版验证码的加载流程，白屏时间接近2s，并且整个过程衔接得并不自然。
         </span>
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
<br />
</span>
</p>
<p style="text-align: center;">
<img class="" data-backh="152" data-backw="558" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz_jpg/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWow44ia4x517nrOVia1GmCicDAd3gOxiaGk04yEBAM6U7jZLAqR7hEX7Xicmw/640?wx_fmt=jpeg" data-copyright="0" data-ratio="0.271875" data-s="300,640" data-src="" data-type="jpeg" data-w="1280" src="/wechat/img/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWow44ia4x517nrOVia1GmCicDAd3gOxiaGk04yEBAM6U7jZLAqR7hEX7Xicmw.jpeg" style="width: 100%;height: auto;" />
</p>
<p style="text-align: center;">
<span style="font-size: 14px;caret-color: rgb(0, 0, 0);">
          图5.1 旧验证码加载流程
          <br />
</span>
</p>
<p style="text-align: center;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
<br />
</span>
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
          因此我们在重构中引入了Skeleton Screen（加载占位图），在验证码加载预期填充灰色的占位图，实现界面加载过程中的平滑过渡效果。这个概念来源于iOS设计规范中的Lanuch Screen（启动屏幕），主要目的是为了解决等待加载过程中出现白屏或界面闪烁造成的割裂感。
         </span>
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
<br />
</span>
</p>
<p style="text-align: center;">
<img class="" data-copyright="0" data-ratio="1.2250580046403712" data-s="300,640" data-src="" data-type="jpeg" data-w="862" src="/wechat/img/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWoFR7icgMvqRXN3Ktma0rgYtWXOzoSoa7uW4IXehdxG4iaGibmSHdNUY2EA.jpeg" style="width: 143px;height: 175px;" />
</p>
<p style="text-align: center;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
          图5.2 骨架屏
         </span>
</p>
<p style="text-align: center;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
<br />
</span>
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
          实现的效果如图5.2所示，用占位图展示验证码的大致骨架，大大提升用户对验证码加载的预期。最终加载流程如图5.3所示。
         </span>
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
<br />
</span>
</p>
<p style="text-align: center;">
<img class="" data-backh="130" data-backw="558" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz_jpg/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWozfc5icOm4NseJs3UGOSYCmnSgZNY1vHIgKYBb77XcbpPmibaDoSicMSMg/640?wx_fmt=jpeg" data-copyright="0" data-ratio="0.23203125" data-s="300,640" data-src="" data-type="jpeg" data-w="1280" src="/wechat/img/kEQaY0b2qU2RvxyhibWhAI9cr6j6iaxBWozfc5icOm4NseJs3UGOSYCmnSgZNY1vHIgKYBb77XcbpPmibaDoSicMSMg.jpeg" style="width: 100%;height: auto;" />
</p>
<p style="text-align: center;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
          图5.3 新验证码加载流程
         </span>
</p>
<p style="text-align: center;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
<br />
</span>
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
          加载占位图的显示不依赖任何页面外部资源，在验证码的HTML加载完成之前就可以显示出验证码的大致轮廓，增加用户的等待预期并减少长时间白屏带来的焦躁情绪，用户体验得以提升。
         </span>
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
<br />
</span>
</p>
<p style="text-align: left;">
<span style="caret-color: rgb(0, 0, 0);font-size: 14px;">
<br />
</span>
</p>
<h1 style=";">
<span style="font-size: 20px;">
<strong>
           6. 优化效果及总结
          </strong>
</span>
</h1>
<p>
<span style="font-size: 20px;">
<strong>
<br />
</strong>
</span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          经过本轮重构以后，验证码整体性能得到了大幅提升。其中，验证码体积减少了38%，http资源请求数由10余个减少为2个。引入骨架屏有效缩短了白屏时间，最耗时的DOM渲染和验证码主逻辑执行时间也分别减少了50%和60%。安卓下全流程加载平均耗时从3.9s减少为1.9s，降低了51%；ios下从3s减少为1.7s，降低了43%。
         </span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<br />
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          本次移动端验证码重构是对前端性能优化的一次完整实践，模块化、资源合并打包、按需缓存、代码压缩等前端的优化思路，在基础前端产品中应用后效果尤为显著，优化后的验证码很大程度上减少了网络链路的开销。并且重构过程中梳理了验证码的加载流程，删减了流程中不合理的异步等待，最终的主逻辑代码中已经没有定时器的影子，这再一次证明了前端通用优化思路的可行性。
         </span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<br />
</p>
<p style="caret-color: rgb(0, 0, 0);">
<span style="font-size: 14px;">
          一个项目存在历史包袱在所难免，随着各种新技术层出不穷，一些老旧的思想和方式势必被更好的实践替代，性能优化是值得前端从事者深入研究的领域，只有不断实践通用优化方法和探索最佳实践标准，才能提升用户体验从而为业务创造价值。为了用户体验，我们一直在努力。
         </span>
</p>
<p style="caret-color: rgb(0, 0, 0);">
<br />
</p>
<p style="caret-color: rgb(0, 0, 0);text-align: center;">
<span style="font-size: 14px;">
</span>
</p>
<p style="max-width: 100%;min-height: 1em;color: rgb(51, 51, 51);text-align: left;">
<span style="max-width: 100%;font-family: 微软雅黑, sans-serif;color: rgb(52, 52, 52);font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">
          我们将对各类技术进行持续的
          <span style="color: rgb(52, 52, 52);font-family: 微软雅黑, sans-serif;font-size: 14px;">
           探索与
          </span>
          研究，为业务提供优质的安全解决方案以及威胁情报感知服务。如果对相关技术及业务安全感兴趣，
         </span>
<span style="max-width: 100%;font-family: 微软雅黑, sans-serif;color: rgb(52, 52, 52);font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">
          欢迎访问007.qq.com，或者关注
         </span>
<span style="max-width: 100%;font-family: 微软雅黑, sans-serif;color: rgb(52, 52, 52);font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;">
          微信公众号
          <span style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">
           了解更多。
          </span>
</span>
</p>
<p style="text-align: center;">
<img class="" data-copyright="0" data-ratio="1.3" data-s="300,640" data-src="" data-type="png" data-w="500" src="/wechat/img/kEQaY0b2qU0YoWtFYU9YlMICIE3cRGEG4YvPGRXz6ORouqicR5kjsHvIGs6iaqPQibeMokia4bVzWNGjPFmCaicr6Qg.png" style="width: 140px;height: 182px;" />
</p>
</div>
</div>

    <div style="display:flex; flex-direction: row; justify-content: space-between">

        
        <li class="previous">
            <a href="/tencent_fsq/2018/10/22/tencent_fsq-2256/">前一篇</a>
        </li>
        

        <div class="postinfo" style="text-align:center;color:gray">
            
            
            <span><a href="/wechattags/internet">internet</a> / <a href="/wechatcategories/tencent_fsq">腾讯防水墙</a></span>
        </div>

        
        <li class="next">
            <a href="/tencent_fsq/2018/08/13/tencent_fsq-2258/">后一篇</a>
        </li>
        

    </div>
</div>

<div style="width: 100%; text-align: center">
    <!-- 匹配内容-lijiaocn -->
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-format="autorelaxed"
         data-ad-client="ca-pub-8176866190626448"
         data-ad-slot="6443696990"></ins>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

        </div>
    </div>
    <!--div class="bottom">
            <p style="color:white">Thanks for use. Remember us.</p>
    </div-->
    <script src="/wechat/assets/js/js.js" charset="utf-8"></script>
    

    
</body>
</html>
